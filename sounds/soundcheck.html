<html>
  <head>
    <link rel="stylesheet" href="/default.css">
    <title>wuwei sound check</title>
  </head>
  <body>
    <div id='sounds'>
      <dialog id='hack-to-force-interaction-for-audio-context' style='width: 45%'>
        <p>In order to open an audio context, browsers require user interaction
        before a page can initialize an <a href="https://webaudio.github.io/web-audio-api/#AudioContext">
        audio&nbsp;context.</a>
        <p>Overall, this is probably a good thing - without it, advertisers,
        in their endless quest to make people want to close the current browser
        window, would doubtless blast the most obnoxious sounds possible on page
        load at every opportunity.
        <p>Therefore, we humbly request your interaction, using the button below.
        <form method="dialog" class="center-hack">
          <button onclick='startSoundcheck();'>I HEREBY INTERACT WITH THIS PAGE</button>
        </form>
        (See also this <a href="https://developer.chrome.com/blog/autoplay/#webaudio">
        Chrome developer blog entry
        </a>)
      </dialog>
      <table>
        <tr data-expands>
          <td data-shows='@key'></td>
          <td><button value='@key' onclick='playSound(this.value);'>play</button> </td>
        </tr>
      </table>
    </div>
    <script src="https://fbmstudios.net/uiulars/uiulator.js"></script>
    <script type="module">
      let sounds = { };
      const uila = uiulator(sounds, document.getElementById('sounds'));
      import { loadSounds, playSound } from "./soundcheck.mjs";

      let audioCtx;
      window.startSoundcheck = function() {
          audioCtx = new AudioContext();
          sounds = loadSounds(audioCtx, sounds);
          uila.update();
      }

      window.playSound = function(which) {
//console.log(`OH HAI NOW PLAYING ${which} =\n${sounds[which]}`);
        if(audioCtx)
            playSound(audioCtx, which);
      }

      document.getElementById('hack-to-force-interaction-for-audio-context').showModal();
    </script>
  </body>
</html>


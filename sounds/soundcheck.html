<html>
  <head>
    <link rel="stylesheet" href="/default.css">
    <title>wuwei sound check</title>
  </head>
  <body>
    <div id='sounds'>
      <dialog id='hack-to-force-interaction-for-audio-context'>
        <form method="dialog">
          <button onclick='startSoundcheck();'>BEGIN</button>
        </form>
      </dialog>
      <table>
        <tr data-expands>
          <td data-shows='@key'></td>
          <td><button value='@key' onclick='playSound(this.value);'>play</button> </td>
        </tr>
      </table>
    </div>
    <script src="https://fbmstudios.net/uiulars/uiulator.js"></script>
    <script type="module">
      let sounds = { };
      const uila = uiulator(sounds, document.getElementById('sounds'));
      import { loadSounds, playSound } from "./soundcheck.mjs";

      let audioCtx;
      window.startSoundcheck = function() {
          // Apparently because advertizers ruin everything, pages
          // need some kind of user interaction before they can get
          // an audio context (or you get a warning).  Hence the
          // whole "start" button thing.
          //  (warning: "The AudioContext was not allowed to start.
          //  It must be resumed (or created) after a user gesture
          //  on the page. https://goo.gl/7K7WLu")
          // .. makes some sense, though it's annoying.
          audioCtx = new AudioContext();
          sounds = loadSounds(audioCtx, sounds);
          uila.update();
      }

      window.playSound = function(which) {
//console.log(`OH HAI NOW PLAYING ${which} =\n${sounds[which]}`);
        if(audioCtx)
            playSound(audioCtx, which);
      }

      document.getElementById('hack-to-force-interaction-for-audio-context').showModal();
    </script>
  </body>
</html>

